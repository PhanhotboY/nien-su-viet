generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String            @id
  email         String            @unique
  image         String?
  name          String
  role          String?
  editedEvents  EventEdit[]
  createdEvents HistoricalEvent[]
}

model HistoricalEvent {
  id           String            @id @default(uuid()) @db.Uuid
  fromYear     Int               @db.SmallInt
  fromMonth    Int?              @db.SmallInt
  fromDay      Int?              @db.SmallInt
  toYear       Int?              @db.SmallInt
  toMonth      Int?              @db.SmallInt
  toDay        Int?              @db.SmallInt
  name         String            @db.VarChar(255)
  content      String
  thumbnailId  String?           @db.Uuid
  authorId     String
  createdAt    DateTime          @default(now()) @db.Timestamp(6)
  updatedAt    DateTime          @updatedAt @db.Timestamp(6)
  fromDateType EVENT_DATE_TYPE   @default(EXACT)
  toDateType   EVENT_DATE_TYPE   @default(EXACT)
  categories   EventCategories[]
  editors      EventEdit[]
  author       User              @relation(fields: [authorId], references: [id], onDelete: Cascade)
  thumbnail    Image?            @relation(fields: [thumbnailId], references: [id])

  @@index([fromYear], map: "idx_event_from_year")
  @@index([fromMonth], map: "idx_event_from_month")
  @@index([fromDay], map: "idx_event_from_day")
  @@index([toYear], map: "idx_event_to_year")
  @@index([toMonth], map: "idx_event_to_month")
  @@index([toDay], map: "idx_event_to_day")
}

model EventCategory {
  id          String            @id @default(uuid()) @db.Uuid
  name        String            @unique @db.VarChar(255)
  slug        String            @unique @db.VarChar(255)
  description String?
  createdAt   DateTime          @default(now()) @db.Timestamp(6)
  updatedAt   DateTime          @updatedAt @db.Timestamp(6)
  events      EventCategories[]

  @@index([slug], map: "idx_event_category_slug")
}

model EventCategories {
  eventId    String          @db.Uuid
  categoryId String          @db.Uuid
  category   EventCategory   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  event      HistoricalEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@id([eventId, categoryId])
  @@index([categoryId], map: "idx_categories_by_category")
  @@index([eventId], map: "idx_categories_by_event")
}

model EventEdit {
  id            String          @id @default(uuid()) @db.Uuid
  eventId       String          @db.Uuid
  editorId      String
  editedAt      DateTime        @default(now()) @db.Timestamp(6)
  prevContent   String?
  newContent    String?
  prevFromYear  Int             @db.SmallInt
  prevFromMonth Int?            @db.SmallInt
  prevFromDay   Int?            @db.SmallInt
  prevToYear    Int?            @db.SmallInt
  prevToMonth   Int?            @db.SmallInt
  prevToDay     Int?            @db.SmallInt
  newFromYear   Int?            @db.SmallInt
  newFromMonth  Int?            @db.SmallInt
  newFromDay    Int?            @db.SmallInt
  newToYear     Int?            @db.SmallInt
  newToMonth    Int?            @db.SmallInt
  newToDay      Int?            @db.SmallInt
  editor        User            @relation(fields: [editorId], references: [id], onDelete: Cascade)
  event         HistoricalEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId], map: "idx_edit_event")
  @@index([editorId], map: "idx_edit_editor")
}

model EventPeriod {
  id          String  @id @default(uuid()) @db.Uuid
  fromYear    Int     @db.SmallInt
  fromMonth   Int?    @db.SmallInt
  fromDay     Int?    @db.SmallInt
  toYear      Int     @db.SmallInt
  toMonth     Int?    @db.SmallInt
  toDay       Int?    @db.SmallInt
  name        String  @unique @db.VarChar(255)
  slug        String  @unique @db.VarChar(255)
  description String?
}

model Image {
  id          String            @id @default(uuid()) @db.Uuid
  caption     String?
  publicUrl   String            @db.VarChar(255)
  description String?
  events      HistoricalEvent[]
}

enum EVENT_DATE_TYPE {
  EXACT
  APPROXIMATE
}
